---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import HeroSlider from '../../components/HeroSlider.astro';
import MetricItem from '../../components/MetricItem.astro';
import PartnersMarquee from '../../components/PartnersMarquee.astro';
import FairSupport from '../../components/FairSupport.astro';
import InstaGrid from '../../components/InstaGrid.astro';
import VisitorFormModal from '../../components/VisitorFormModal.astro';
import ParticipantFormModal from '../../components/ParticipantFormModal.astro';


// Get content
const homeContent = await getCollection('home');
const partnersContent = await getCollection('partners');

const content = homeContent.find(item => item.id === 'tr')?.data;

// Load dynamic partners from CMS (folder collection)
const allPartners = partnersContent
  .filter(partner => partner.data.is_active !== false) // Show active partners
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999)) // Sort by order
  .map(partner => ({
    name: partner.data.name,
    logo: partner.data.logo,
    website: partner.data.website
  }));

console.log('🤝 PARTNERS DEBUG: Active partners loaded:', allPartners.length);
const partners = allPartners;

if (!content) {
  throw new Error('Turkish content not found');
}

// Load hero slides from CMS
console.log('🎬 SLIDER DEBUG: Loading CMS hero slides...');
const heroSlidesData = await getCollection('hero-slides');
const activeSlides = heroSlidesData
  .filter(slide => slide.data.is_active !== false)
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));

console.log('🎬 SLIDER DEBUG: Active hero slides found:', activeSlides.length);

// Convert CMS slides to hero format for TR
const cmsSlides = activeSlides.map(slide => ({
  backgroundImage: slide.data.background_image,
  card: {
    title: slide.data.title_tr,
    dateText: slide.data.date_tr || '',
    location: slide.data.location_tr || '',
    description: slide.data.description_tr || '',
    fairName: slide.data.title_tr,
    fairLogo: slide.data.logo || "/images/fuarlar-logo.png",
    fairWebsite: slide.data.website_url || '#',
    miniImages: slide.data.mini_images || [],
    mapsEmbed: slide.data.maps_embed || ''
  }
}));

// Update hero data with CMS slides if available
if (cmsSlides.length > 0) {
  content.hero.slides = cmsSlides;
  console.log('🎬 SLIDER DEBUG: Hero slides updated with CMS hero-slides data');
} else {
  console.log('🎬 SLIDER DEBUG: No CMS hero slides found, using static data');
}

const locale = 'tr';
const currentPath = '/';

// Check for success parameter
const url = new URL(Astro.request.url);
const success = url.searchParams.get('success');
---

<BaseLayout
  title="Türkel Fuarcılık - Uluslararası Fuar Organizasyonu"
  description="Türk fuarcılık sektörünün önde gelen ve deneyimli bir profesyonel uluslararası fuar ve ticari etkinlik organizatörü olan Türkel Fuarcılık A.Ş."
  locale={locale}
  canonical="/tr"
>
  <!-- Header -->
  <Header locale={locale} />

  <!-- Success Notification -->
  {success && (
    <div id="success-notification" class="fixed top-4 right-4 bg-green-600 text-white px-6 py-4 rounded-lg shadow-2xl z-[9999] max-w-md animate-slide-in">
      <div class="flex items-center justify-between">
        <div>
          <div class="font-semibold mb-1" style="font-family: 'Radio Canada Big', sans-serif;">
            {success === 'visitor' && 'Ziyaretçi Formu Gönderildi!'}
            {success === 'participant' && 'Katılımcı Formu Gönderildi!'}
            {success === 'contact' && 'Mesajınız Gönderildi!'}
            {success === 'newsletter' && 'Bülten Aboneliği Başarılı!'}
          </div>
          <div class="text-sm opacity-90" style="font-family: 'Radio Canada Big', sans-serif;">
            En kısa sürede sizinle iletişime geçeceğiz.
          </div>
        </div>
        <button onclick="document.getElementById('success-notification').remove()" class="ml-4 text-white hover:text-gray-200 text-xl font-bold">
          ✕
        </button>
      </div>
    </div>
  )}

  <!-- Main Content -->
  <main>
    <!-- Hero Slider -->
    <HeroSlider locale={locale} heroData={content.hero} />

    <!-- Hero Subtitle Text - Removed, moved to about section -->

    <!-- About Section -->
    <section class="about-section py-20 bg-white">
      <div class="mx-auto px-5" style="max-width: 1680px; background-color: white; border-radius: 10px; margin: 20px auto;">
        <!-- Top Section: Metrics + Hero Subtitle -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-16 items-start mb-16">
          
          <!-- Left: Metrics Section -->
          <div class="lg:col-span-8">
            <div class="grid grid-cols-3 gap-4 sm:gap-8 relative">
              {content.metrics.map((metric, index) => (
                <div class="text-center sm:text-left relative">
                  {index === 0 && (
                    <div class="absolute top-0 sm:top-0 -left-2 sm:-left-4 w-[2px] sm:w-[3px] h-[60px] sm:h-[104px] bg-[#CE1A28]"></div>
                  )}
                  <div class="text-[36px] sm:text-[65px] font-semibold text-[#16243D] mb-1 sm:mb-2 leading-none font-['Radio_Canada_Big']">
                    {metric.value}
                  </div>
                  <div class="text-sm sm:text-lg text-[#16243D] font-['Radio_Canada_Big']">
                    {metric.label}
                  </div>
                  {index < content.metrics.length - 1 && (
                    <div class="absolute top-0 sm:top-0 -right-2 sm:-right-4 w-[2px] sm:w-[3px] h-[60px] sm:h-[104px] bg-[#CE1A28]"></div>
                  )}
                </div>
              ))}
            </div>
          </div>

          <!-- Right: Hero Subtitle Text -->
          <div class="lg:col-span-4 flex items-center -ml-2">
            <p class="text-lg text-black leading-[1.5] max-w-[650px] ml-4 font-normal" style="font-family: 'Radio Canada Big', sans-serif; font-weight: 400;">
              15 farklı sektörde yüzlerce iş ortağıyla, şimdiye kadar gerçekleştirdiğimiz fuar deneyimlerimiz ve 4 kıtaya yayılan geniş ağımızla küresel ölçekte güçlü fuar organizasyonları sunuyoruz.
            </p>
          </div>
        </div>

        <!-- Bottom Section: About Content + Experience Card -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-16 items-start">
          
          <!-- Left Content -->
          <div class="lg:col-span-7">
            <!-- Section Header -->
            <div class="flex items-center gap-1 mb-4">
              <div class="flex items-center">
                <img src="/images/turkel-icon-black.svg" alt="Türkel Icon" class="w-12 h-12" style="width: 48px !important; height: 48px !important; min-width: 48px; min-height: 48px; display: block !important;" />
              </div>
              <h2 class="text-base font-semibold text-[#CE1A28] uppercase tracking-[10%] font-['Radio_Canada_Big']">
                Hakkımızda
              </h2>
            </div>
            
            <!-- Main Title -->
            <h3 class="text-[42px] font-bold text-[#16243D] mb-8 leading-[1.15] max-w-[597px] font-['Radio_Canada_Big'] tracking-[-0.02em]">
              Türkel Fuarcılık ile küresel başarıya ulaşın
            </h3>

            <!-- About Content -->
            <div class="max-w-[1000px] mb-8">
              <p class="text-text-secondary leading-relaxed">
                Türk fuarcılık sektörünün önde gelen ve deneyimli bir profesyonel uluslararası fuar ve ticari etkinlik organizatörü olan <strong>Türkel Fuarcılık A.Ş.</strong> <strong>İstanbul Merkez</strong>, <strong>Moskova/RF</strong> ve <strong>Almatı/Kazakistan</strong> saha ofislerinde görevli deneyimli, yenilikçi ve özverili <strong>76 kişilik profesyonel yönetici ve satış ekibi kadrosuyla</strong> fuar katılım planlaması, organizasyon yönetimi, tanıtım ve pazarlama ile iletişim konularında Türk ve yabancı müşterilerine uluslararası standartlara uygun seçkin hizmetler sunmaktadır.
              </p>
              <br />
              <p class="text-text-secondary leading-relaxed">
                Ayrıca, <strong>Türkel Fuarcılık A.Ş.</strong> uluslararası ticari sektörel fuar katılımcısı müşterilerine; fuar standı tasarımı ve kurulumu ile teknik hizmetler, lojistik ve nakliye, uluslararası seyahat, ulaşım ve konaklama alanlarında da ayrıcalıklı hizmet desteği sağlamaktadır.
              </p>
            </div>
              
            <!-- CTA Button -->
            <div class="mt-12">
              <a 
                href="/tr/hakkimizda/"
                class="inline-flex items-center justify-center bg-[rgba(206,26,40,0.09)] text-[#CF213C] px-12 py-4 rounded-[30px] font-medium hover:bg-[#CE1A28] hover:text-white transition-all duration-300 text-lg font-['Radio_Canada_Big'] w-[186px] h-[58px]"
              >
                Daha Fazla
              </a>
            </div>
          </div>

          <!-- Right Experience Card - Hidden on mobile -->
          <div class="hidden lg:flex lg:col-span-5 justify-end">
            <div class="mt-32 mr-8">
              <div class="bg-[#CE1A28] rounded-[15px] text-center text-white relative overflow-hidden" style="width: 280px; height: 264px; transform: translateX(180px);">
                <!-- Modern corner triangle -->
                <div class="absolute bottom-0 right-0 w-0 h-0" style="border-left: 40px solid transparent; border-bottom: 40px solid white; border-top: 0px solid transparent;"></div>
                
                <div class="flex flex-col items-center justify-center h-full px-[53px] py-[58px]">
                  <div class="text-[128px] font-bold leading-[0.625] text-white font-['Radio_Canada_Big'] uppercase mb-3">
                    30
                  </div>
                  <div class="text-xs font-medium uppercase tracking-[15%] text-white font-['Radio_Canada_Big'] leading-[1.3]">
                    yıllık sektör deneyimi
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- Partners Section -->
    <PartnersMarquee partners={partners} title="PARTNERLERİMİZ" />

    <!-- Fair Support Section -->
    <FairSupport locale={locale} content={content.fairSupport} />

    <!-- Instagram Gallery Section -->
    <InstaGrid items={content.instagram} />


  </main>

  <!-- Footer -->
  <Footer locale={locale} content={content.footer} />

  <!-- Modals -->
  <VisitorFormModal locale={locale} />
  <ParticipantFormModal locale={locale} />
</BaseLayout>

<script>
  // Always run success debug
  document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const successParam = urlParams.get('success');
    console.log('🎯 SUCCESS DEBUG:');
    console.log('  - URL:', window.location.href);
    console.log('  - Search params:', window.location.search);
    console.log('  - Success parameter:', successParam);
    console.log('  - Notification element:', document.getElementById('success-notification'));
    console.log('  - All URL params:', Object.fromEntries(urlParams));
    
    // Force show notification if success param exists
    if (successParam) {
      const notification = document.getElementById('success-notification');
      if (notification) {
        console.log('🎯 FORCING NOTIFICATION DISPLAY');
        notification.style.display = 'block';
        notification.style.visibility = 'visible';
        notification.style.opacity = '1';
        notification.style.zIndex = '99999';
        notification.style.position = 'fixed';
        notification.style.top = '1rem';
        notification.style.right = '1rem';
        
        // Auto hide after 5 seconds
        setTimeout(() => {
          notification.style.opacity = '0';
          notification.style.transform = 'translateX(100%)';
          setTimeout(() => notification.remove(), 300);
        }, 5000);
      } else {
        console.log('❌ SUCCESS NOTIFICATION ELEMENT NOT FOUND!');
        
        // Create notification manually if element not found
        const notification = document.createElement('div');
        notification.id = 'success-notification-manual';
        notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-4 rounded-lg shadow-2xl z-[9999] max-w-md';
        notification.innerHTML = `
          <div class="flex items-center justify-between">
            <div>
              <div class="font-semibold mb-1">
                ${successParam === 'visitor' ? 'Ziyaretçi Formu Gönderildi!' : 
                  successParam === 'participant' ? 'Katılımcı Formu Gönderildi!' :
                  successParam === 'contact' ? 'Mesajınız Gönderildi!' :
                  successParam === 'newsletter' ? 'Bülten Aboneliği Başarılı!' : 'Form Gönderildi!'}
              </div>
              <div class="text-sm opacity-90">
                En kısa sürede sizinle iletişime geçeceğiz.
              </div>
            </div>
            <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200 text-xl font-bold">
              ✕
            </button>
          </div>
        `;
        document.body.appendChild(notification);
        console.log('🎯 MANUAL NOTIFICATION CREATED');
      }
    }
  });
</script>

<style>
  /* Success notification animation */
  @keyframes slide-in {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  .animate-slide-in {
    animation: slide-in 0.3s ease-out;
  }

  /* Hero section specific styles */
  .hero-section {
    position: relative;
    overflow: hidden;
  }
  
  .hero-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(22, 36, 61, 0.8) 0%, rgba(22, 36, 61, 0.4) 100%);
    z-index: 1;
  }
  
  /* Ensure content is above overlay */
  .hero-section .container {
    position: relative;
    z-index: 2;
  }
  
  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }
  
  /* Performance optimizations */
  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
    
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>
