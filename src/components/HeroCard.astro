---
import { type Locale } from '../lib/i18n';
import { Calendar, MapPin, ExternalLink, Menu, X } from 'lucide-astro';

interface Props {
  locale: Locale;
  card: {
    title: string;
    dateText?: string;
    location?: string;
    description?: string;
    fairName?: string;
    fairLogo?: string;
    fairWebsite?: string;
    buttons?: Array<{ text: string; url: string }>;
  };
}

const { locale, card } = Astro.props;
---

<div class="hero-card bg-[#1B1C1B] rounded-[15px] sm:rounded-[20px] shadow-lg relative z-10 overflow-hidden w-[280px] h-[400px] sm:w-[350px] sm:h-[500px] lg:w-[484px] lg:h-[688px]" id="hero-card">
  
  <!-- Background Image with Logo Overlay -->
  <div class="absolute inset-0 bg-gradient-to-br from-gray-800 to-gray-900">
    <!-- Background Pattern or Image -->
    <div class="absolute inset-0 bg-[url('/images/fuarlar-arkaplan.jpg')] bg-cover bg-center opacity-20"></div>
    
    <!-- Logo Overlay - Centered and Prominent -->
    {card.fairLogo && (
      <div class="absolute inset-0 flex items-center justify-center">
        <div class="bg-white/95 backdrop-blur-sm rounded-xl p-4 sm:p-6 lg:p-8 shadow-2xl">
          <img 
            src={card.fairLogo}
            alt={card.fairName || 'Fair Logo'}
            class="h-16 sm:h-20 lg:h-24 w-auto max-w-[200px] sm:max-w-[250px] lg:max-w-[300px] object-contain"
          />
        </div>
      </div>
    )}
  </div>
  
  <!-- Main Content View -->
  <div class="card-content main-view absolute inset-0">
    <!-- Red accent bar with year (moved to left) -->
    <div class="absolute top-6 sm:top-8 lg:top-12 left-4 sm:left-6 lg:left-8 z-20">
      <div class="w-[30px] sm:w-[36px] lg:w-[42px] h-[2px] sm:h-[2.5px] lg:h-[3px] bg-[#CE1A28] rounded-full"></div>
      <div class="text-white text-[10px] sm:text-[11px] lg:text-[12px] font-medium mt-1 sm:mt-1.5 lg:mt-2 text-left">2025</div>
    </div>
    
    <!-- Hamburger Menu Button (right top) -->
    <button 
      class="absolute top-6 sm:top-8 lg:top-12 right-4 sm:right-6 lg:right-8 w-6 sm:w-7 lg:w-8 h-6 sm:h-7 lg:h-8 flex flex-col justify-center items-center gap-0.5 sm:gap-0.5 lg:gap-1 hover:opacity-80 transition-opacity z-20"
      id="detail-toggle"
      aria-label={locale === 'tr' ? 'Detaylarƒ± g√∂ster' : 'Show details'}
    >
      <div class="w-3 sm:w-4 lg:w-5 h-0.5 bg-white"></div>
      <div class="w-3 sm:w-4 lg:w-5 h-0.5 bg-white"></div>
      <div class="w-3 sm:w-4 lg:w-5 h-0.5 bg-white"></div>
    </button>
    
    <!-- Content Cards Container -->
    <div class="absolute bottom-4 sm:bottom-6 lg:bottom-8 left-4 sm:left-6 lg:left-8 right-4 sm:right-6 lg:right-8 z-20">
      
      <!-- Fair Title Card -->
      <div class="bg-white/10 backdrop-blur-md rounded-lg p-3 sm:p-4 lg:p-5 mb-3 sm:mb-4">
        <h2 class="text-white font-semibold text-[12px] sm:text-[14px] lg:text-[16px] leading-tight text-center mb-2">
          {card.title}
        </h2>
        
        <!-- Date and Location Info -->
        <div class="flex justify-center gap-2 sm:gap-3 mb-2">
          {card.dateText && (
            <div class="flex items-center gap-1 text-white/80 text-[8px] sm:text-[10px] lg:text-xs">
              <Calendar size={10} class="sm:w-3 sm:h-3 lg:w-4 lg:h-4" />
              <span>{card.dateText}</span>
            </div>
          )}
          
          {card.location && (
            <div class="flex items-center gap-1 text-white/80 text-[8px] sm:text-[10px] lg:text-xs">
              <MapPin size={10} class="sm:w-3 sm:h-3 lg:w-4 lg:h-4" />
              <span>{card.location}</span>
            </div>
          )}
        </div>
        
        <!-- Description -->
        {card.description && (
          <p class="text-white/90 text-[10px] sm:text-[12px] lg:text-sm leading-relaxed text-center">
            {card.description}
          </p>
        )}
      </div>

      <!-- Fair Name Action Card -->
      <a 
        href={card.fairWebsite || '#'}
        target={card.fairWebsite ? "_blank" : "_self"}
        rel={card.fairWebsite ? "noopener noreferrer" : undefined}
        class="block bg-[#CE1A28] hover:bg-[#B01625] rounded-lg p-3 sm:p-4 lg:p-5 text-center transition-all duration-300 transform hover:scale-105"
        aria-label={locale === 'tr' ? 'Fuarƒ±n web sitesine git' : 'Go to fair website'}
      >
        <div class="flex items-center justify-center gap-2">
          <span class="text-white font-medium text-[10px] sm:text-[12px] lg:text-sm uppercase">
            {card.fairName || 'HOMEDECO KAZAKƒ∞STAN'}
          </span>
          {card.fairWebsite && (
            <ExternalLink size={12} class="text-white w-3 h-3 sm:w-4 sm:h-4" />
          )}
        </div>
      </a>
      
    </div>
  </div>

  <!-- Detail Content View -->
  <div class="card-content detail-view absolute inset-0 bg-[#1B1C1B] overflow-y-auto">
    <!-- Close Button -->
    <button 
      class="absolute top-6 sm:top-8 lg:top-12 right-4 sm:right-6 lg:right-8 w-6 sm:w-7 lg:w-8 h-6 sm:h-7 lg:h-8 flex items-center justify-center hover:opacity-80 transition-opacity z-30"
      id="detail-close"
      aria-label={locale === 'tr' ? 'Kapat' : 'Close'}
    >
      <X size={16} class="text-white sm:w-5 sm:h-5 lg:w-6 lg:h-6" />
    </button>
    
    <!-- Content Container with Cards -->
    <div class="pt-[60px] sm:pt-[70px] lg:pt-[80px] px-4 sm:px-6 lg:px-8 pb-6">
      
      <!-- Fair Venue Card -->
      <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 sm:p-5 lg:p-6 mb-4 sm:mb-5">
        <h3 class="text-white font-semibold text-[14px] sm:text-[16px] lg:text-[18px] text-center uppercase mb-2">
          FUAR ALANI
        </h3>
        <p class="text-white/80 text-[11px] sm:text-[12px] lg:text-sm text-center">
          KTSDS "Atakent", Almaty, pavilion 09,10
        </p>
      </div>

      <!-- Fair Images Card -->
      <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 sm:p-5 lg:p-6 mb-4 sm:mb-5">
        <h3 class="text-white font-semibold text-[12px] sm:text-[14px] lg:text-[16px] text-center uppercase mb-3 sm:mb-4">
          FUAR GALERƒ∞Sƒ∞
        </h3>
        <div class="grid grid-cols-3 gap-2 sm:gap-3">
          <div class="aspect-square">
            <img 
              src="/images/instagram-post.jpg" 
              alt="Fuar G√∂rseli" 
              class="w-full h-full object-cover rounded-lg"
              loading="lazy"
            />
          </div>
          <div class="aspect-square">
            <img 
              src="/images/instagram-post.jpg" 
              alt="Fuar G√∂rseli" 
              class="w-full h-full object-cover rounded-lg"
              loading="lazy"
            />
          </div>
          <div class="aspect-square">
            <img 
              src="/images/instagram-post.jpg" 
              alt="Fuar G√∂rseli" 
              class="w-full h-full object-cover rounded-lg"
              loading="lazy"
            />
          </div>
        </div>
      </div>

      <!-- Location Card -->
      <div class="bg-white/10 backdrop-blur-md rounded-lg p-4 sm:p-5 lg:p-6">
        <h3 class="text-white font-semibold text-[12px] sm:text-[14px] lg:text-[16px] text-center uppercase mb-3 sm:mb-4">
          LOKASYON
        </h3>
        <div class="rounded-lg h-[120px] sm:h-[140px] lg:h-[160px] overflow-hidden">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2906.5739536742!2d76.90288781544!3d43.22475328484!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x38836f1b5b5b5b5b%3A0x104a5a5a5a5a5a5a!2sAtakent%20Exhibition%20Center!5e0!3m2!1sen!2str!4v1640000000000!5m2!1sen!2str"
            width="100%"
            height="100%"
            style="border:0;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            title="Atakent Exhibition Center Location"
            class="rounded-lg"
          ></iframe>
        </div>
      </div>
      
    </div>
  </div>
</div>

<script>
  // Use a more specific approach to avoid conflicts
  function initHeroCardInteractions() {
    console.log('üîß Initializing HeroCard interactions...');
    
    const heroCard = document.getElementById('hero-card');
    if (!heroCard) {
      console.error('‚ùå Hero card not found!');
      return;
    }
    console.log('‚úÖ Hero card found:', heroCard);

    // Mobile responsive debug
    console.log('üì± MOBILE DEBUG - Hero Card Visibility:');
    console.log('  - Hero card display:', window.getComputedStyle(heroCard).display);
    console.log('  - Hero card visibility:', window.getComputedStyle(heroCard).visibility);
    console.log('  - Hero card width:', window.getComputedStyle(heroCard).width);
    console.log('  - Hero card height:', window.getComputedStyle(heroCard).height);
    console.log('  - Hero card position:', window.getComputedStyle(heroCard).position);
    console.log('  - Hero card z-index:', window.getComputedStyle(heroCard).zIndex);
    
    // Check if hero card is actually visible in viewport
    const rect = heroCard.getBoundingClientRect();
    console.log('üìê Hero card position in viewport:', {
      top: rect.top,
      left: rect.left,
      right: rect.right,
      bottom: rect.bottom,
      width: rect.width,
      height: rect.height,
      isVisible: rect.width > 0 && rect.height > 0
    });

    const detailToggle = heroCard.querySelector('#detail-toggle');
    const detailClose = heroCard.querySelector('#detail-close');
    const mainView = heroCard.querySelector('.main-view') as HTMLElement;
    const detailView = heroCard.querySelector('.detail-view') as HTMLElement;
    
    console.log('üîç Elements found:');
    console.log('  - detailToggle:', detailToggle);
    console.log('  - detailClose:', detailClose);
    console.log('  - mainView:', mainView);
    console.log('  - detailView:', detailView);

    function showDetailView() {
      console.log('üîÑ showDetailView() called');
      
      if (mainView && detailView) {
        console.log('üîÑ MOBILE RESPONSIVE: Display kontrol√º');
        
        // Mobile responsive i√ßin g√º√ßl√º CSS
        mainView.style.display = 'none';
        detailView.style.display = 'block';
        detailView.style.position = 'absolute';
        detailView.style.top = '0';
        detailView.style.left = '0';
        detailView.style.right = '0';
        detailView.style.bottom = '0';
        detailView.style.width = '100%';
        detailView.style.height = '100%';
        detailView.style.zIndex = '10';
        detailView.style.backgroundColor = '#1B1C1B';
        
        console.log('‚úÖ Detail view mobile responsive oldu!');
        console.log('üì± Detail view styles:', {
          display: detailView.style.display,
          position: detailView.style.position,
          width: detailView.style.width,
          height: detailView.style.height,
          zIndex: detailView.style.zIndex
        });
      } else {
        console.error('‚ùå mainView or detailView is null!');
        console.log('üîç Debug info:', { mainView, detailView, heroCard });
      }
    }

    function showMainView() {
      console.log('üîÑ showMainView() called');
      if (mainView && detailView) {
        console.log('üîÑ BASIT √á√ñZ√úM: Ana g√∂r√ºn√ºme d√∂n');
        
        // √áok basit √ß√∂z√ºm - sadece display
        mainView.style.display = 'block';
        detailView.style.display = 'none';
        
        console.log('‚úÖ Main view g√∂r√ºn√ºr oldu!');
      } else {
        console.error('‚ùå mainView or detailView is null in showMainView!');
      }
    }

    // Event listeners
    if (detailToggle) {
      console.log('‚úÖ Adding click listener to detailToggle');
      detailToggle.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        console.log('üñ±Ô∏è Detail toggle clicked!');
        showDetailView();
      });
    } else {
      console.error('‚ùå detailToggle not found!');
    }
    
    if (detailClose) {
      console.log('‚úÖ Adding click listener to detailClose');
      detailClose.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        console.log('üñ±Ô∏è Detail close clicked!');
        showMainView();
      });
    } else {
      console.error('‚ùå detailClose not found!');
    }
  }

  // Debug: Check HeroCard images
  function debugHeroCardImages() {
    console.log('üîç DEBUG: HeroCard Images Check...');
    
    // Check all images in hero card
    const heroCard = document.querySelector('.hero-card');
    if (heroCard) {
      const images = heroCard.querySelectorAll('img');
      console.log(`üì∑ Found ${images.length} images in hero card:`);
      images.forEach((img, index) => {
        console.log(`${index + 1}. ${img.src} - ${img.complete ? 'loaded' : 'loading'} - ${img.naturalWidth}x${img.naturalHeight}`);
        
        // Add error handler
        img.onerror = () => {
          console.error(`‚ùå Hero card image failed to load: ${img.src}`);
        };
        
        img.onload = () => {
          console.log(`‚úÖ Hero card image loaded: ${img.src}`);
        };
      });
    }
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      initHeroCardInteractions();
      debugHeroCardImages();
    });
  } else {
    initHeroCardInteractions();
    debugHeroCardImages();
  }
</script>

<style>
  .hero-card {
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    position: relative;
    overflow: hidden;
  }
  
  .card-content {
    transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
  }
  
  .main-view {
    display: block;
    z-index: 10;
  }
  
  .detail-view {
    display: none;
    z-index: 20;
    background-color: #1B1C1B;
  }

  /* Card styling improvements */
  .hero-card .bg-white\/10 {
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .hero-card .bg-white\/95 {
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  /* Smooth hover effects */
  .hero-card .transform:hover {
    transform: scale(1.05);
  }
  
  .hero-card .transition-all {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Ensure text is visible in detail view */
  .detail-view h3,
  .detail-view p,
  .detail-view span,
  .detail-view button {
    color: white !important;
  }
  
  /* Make sure images are visible */
  .detail-view img {
    display: block;
  }
  
  /* Background image positioning */
  .hero-card .bg-\[url\(\'\/images\/fuarlar-arkaplan\.jpg\'\)\] {
    background-position: center;
    background-size: cover;
    background-repeat: no-repeat;
  }
  
  @media (max-width: 1024px) {
    .hero-card {
      margin-top: 2rem;
      width: 350px !important;
      max-width: 90vw !important;
      height: 500px !important;
      min-height: 500px !important;
    }
    
    /* Override Tailwind classes */
    #hero-card {
      width: 350px !important;
      max-width: 90vw !important;
      height: 500px !important;
    }
    
    .detail-view {
      overflow-y: auto;
      height: 100% !important;
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
    }
    
    .detail-view .rounded-lg,
    .detail-view [class*="rounded-"] {
      border-radius: 8px;
    }
    
    /* Tablet card adjustments */
    .hero-card .bg-white\/10 {
      padding: 1rem !important;
    }
  }
  
  @media (max-width: 640px) {
    .hero-card {
      width: 280px !important;
      max-width: 85vw !important;
      height: 400px !important;
      min-height: 400px !important;
    }
    
    /* Override Tailwind classes for mobile */
    #hero-card {
      width: 280px !important;
      max-width: 85vw !important;
      height: 400px !important;
    }
    
    .detail-view {
      padding-bottom: 1rem;
      overflow-y: auto;
    }
    
    .main-view,
    .detail-view {
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      width: 100% !important;
      height: 100% !important;
    }
    
    /* Mobile card adjustments */
    .hero-card .bg-white\/10 {
      padding: 0.75rem !important;
    }
    
    .hero-card .bg-white\/95 {
      padding: 1rem !important;
    }
  }
  
  /* Animation improvements */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .hero-card .bg-white\/10,
  .hero-card .bg-\[\#CE1A28\] {
    animation: fadeIn 0.4s ease-out;
  }
</style>
