---
import { X } from 'lucide-astro';
import { getFairOptions } from '../utils/fair-options';

interface Props {
  locale: 'tr' | 'en';
}

const { locale } = Astro.props;

// Get fair options from CMS
const fairOptions = await getFairOptions(locale);

// Legacy static options (kept as fallback)
const legacyFairOptions = [
  { value: 'homedeco-kazakhstan', label: locale === 'tr' ? 'Homedeco Kazakistan' : 'Homedeco Kazakhstan' },
  { value: 'leshow-moscow', label: locale === 'tr' ? 'Leshow Moskova' : 'Leshow Moscow' },
  { value: 'leshow-istanbul', label: locale === 'tr' ? 'Leshow İstanbul' : 'Leshow Istanbul' },
  { value: 'buildexpo-almaty', label: locale === 'tr' ? 'BuildExpo Almatı' : 'BuildExpo Almaty' },
  { value: 'foodexpo-tashkent', label: locale === 'tr' ? 'FoodExpo Taşkent' : 'FoodExpo Tashkent' },
  { value: 'texexpo-baku', label: locale === 'tr' ? 'TexExpo Bakü' : 'TexExpo Baku' },
  { value: 'medexpo-tbilisi', label: locale === 'tr' ? 'MedExpo Tiflis' : 'MedExpo Tbilisi' },
  { value: 'autoexpo-kiev', label: locale === 'tr' ? 'AutoExpo Kiev' : 'AutoExpo Kiev' },
  { value: 'beautyexpo-minsk', label: locale === 'tr' ? 'BeautyExpo Minsk' : 'BeautyExpo Minsk' },
  { value: 'techexpo-warsaw', label: locale === 'tr' ? 'TechExpo Varşova' : 'TechExpo Warsaw' },
  { value: 'agriexpo-prague', label: locale === 'tr' ? 'AgriExpo Prag' : 'AgriExpo Prague' },
  { value: 'energyexpo-budapest', label: locale === 'tr' ? 'EnergyExpo Budapeşte' : 'EnergyExpo Budapest' },
  { value: 'fashionexpo-sofia', label: locale === 'tr' ? 'FashionExpo Sofya' : 'FashionExpo Sofia' },
  { value: 'homeexpo-bucharest', label: locale === 'tr' ? 'HomeExpo Bükreş' : 'HomeExpo Bucharest' },
  { value: 'sportexpo-belgrade', label: locale === 'tr' ? 'SportExpo Belgrad' : 'SportExpo Belgrade' },
  { value: 'giftexpo-zagreb', label: locale === 'tr' ? 'GiftExpo Zagreb' : 'GiftExpo Zagreb' },
  { value: 'jewelryexpo-ljubljana', label: locale === 'tr' ? 'JewelryExpo Ljubljana' : 'JewelryExpo Ljubljana' },
  { value: 'packexpo-skopje', label: locale === 'tr' ? 'PackExpo Üsküp' : 'PackExpo Skopje' },
  { value: 'plasticexpo-sarajevo', label: locale === 'tr' ? 'PlasticExpo Saraybosna' : 'PlasticExpo Sarajevo' },
  { value: 'metalexpo-podgorica', label: locale === 'tr' ? 'MetalExpo Podgorica' : 'MetalExpo Podgorica' },
  { value: 'woodexpo-tirana', label: locale === 'tr' ? 'WoodExpo Tiran' : 'WoodExpo Tirana' },
  { value: 'chemexpo-chisinau', label: locale === 'tr' ? 'ChemExpo Kişinev' : 'ChemExpo Chisinau' },
  { value: 'printexpo-yerevan', label: locale === 'tr' ? 'PrintExpo Erivan' : 'PrintExpo Yerevan' },
  { value: 'securityexpo-astana', label: locale === 'tr' ? 'SecurityExpo Astana' : 'SecurityExpo Astana' },
  { value: 'tourismexpo-bishkek', label: locale === 'tr' ? 'TourismExpo Bişkek' : 'TourismExpo Bishkek' },
  { value: 'educationexpo-dushanbe', label: locale === 'tr' ? 'EducationExpo Duşanbe' : 'EducationExpo Dushanbe' },
  { value: 'healthexpo-ashgabat', label: locale === 'tr' ? 'HealthExpo Aşkabat' : 'HealthExpo Ashgabat' },
  { value: 'itexpo-riga', label: locale === 'tr' ? 'ITExpo Riga' : 'ITExpo Riga' },
  { value: 'greenexpo-vilnius', label: locale === 'tr' ? 'GreenExpo Vilnius' : 'GreenExpo Vilnius' },
  { value: 'marineexpo-tallinn', label: locale === 'tr' ? 'MarineExpo Tallinn' : 'MarineExpo Tallinn' },
  { value: 'other', label: locale === 'tr' ? 'Diğer' : 'Other' }
];
---

<!-- Modal Backdrop -->
<div id="participant-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
  <!-- Modal Container -->
  <div class="bg-white rounded-[15px] w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl">
    
    <!-- Modal Header -->
    <div class="sticky top-0 bg-white rounded-t-[15px] border-b border-gray-100 px-8 py-6 flex items-center justify-between z-10 shadow-sm">
      <div>
        <h2 class="text-2xl font-bold text-[#16243D] mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
          {locale === 'tr' ? 'Katılımcı Formu' : 'Participant Form'}
        </h2>
        <p class="text-gray-600 text-sm" style="font-family: 'Radio Canada Big', sans-serif;">
          {locale === 'tr' ? 'Fuar katılımı için bilgilerinizi paylaşın' : 'Share your information for fair participation'}
        </p>
      </div>
      <button 
        id="close-participant-modal" 
        class="p-2 hover:bg-gray-100 rounded-full transition-colors"
        aria-label={locale === 'tr' ? 'Kapat' : 'Close'}
      >
        <X size={24} class="text-gray-500" />
      </button>
    </div>

    <!-- Modal Content -->
    <div class="px-8 py-6">
      <form 
        id="participant-form" 
        class="space-y-6"
      >
        <!-- Hidden fields -->
        <input type="hidden" name="form-type" value="participant" />
        <input type="hidden" name="language" value={locale} />
        
        <!-- Fair Information Section -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-[#16243D] border-b border-gray-200 pb-2" style="font-family: 'Radio Canada Big', sans-serif;">
            {locale === 'tr' ? 'Fuar Bilgileri' : 'Fair Information'}
          </h3>
          
          <!-- Fair Selection -->
          <div>
            <label for="participant-fair-select" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
              {locale === 'tr' ? 'Katılmak İstediğiniz Fuar' : 'Fair You Want to Participate'} *
            </label>
            <div class="relative">
              <input 
                type="text" 
                id="participant-fair-search" 
                placeholder={locale === 'tr' ? 'Fuar ara veya seç...' : 'Search or select a fair...'}
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all"
                style="font-family: 'Radio Canada Big', sans-serif;"
                autocomplete="off"
              />
              <input type="hidden" id="participant-fair-select" name="fair" required />
              <div id="participant-fair-dropdown" class="absolute z-20 w-full bg-white border border-gray-300 rounded-lg mt-1 max-h-60 hidden shadow-lg custom-scrollbar">
                <div class="overflow-y-auto max-h-60 rounded-lg">
                  {fairOptions.map(option => (
                    <div 
                      class="px-4 py-2 hover:bg-gray-100 cursor-pointer participant-fair-option" 
                      data-value={option.value}
                      style="font-family: 'Radio Canada Big', sans-serif;"
                    >
                      {option.label}
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>

          <!-- Stand Size -->
          <div>
            <label for="stand-size" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
              {locale === 'tr' ? 'İstediğiniz Stand Büyüklüğü (m²)' : 'Desired Stand Size (m²)'} *
            </label>
            <input 
              type="number" 
              id="stand-size" 
              name="standSize" 
              min="1"
              required
              placeholder={locale === 'tr' ? 'Örn: 12' : 'e.g: 12'}
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all"
              style="font-family: 'Radio Canada Big', sans-serif;"
            />
          </div>
        </div>

        <!-- Personal Information Section -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-[#16243D] border-b border-gray-200 pb-2" style="font-family: 'Radio Canada Big', sans-serif;">
            {locale === 'tr' ? 'Kişisel Bilgiler' : 'Personal Information'}
          </h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- First Name -->
            <div>
              <label for="participant-first-name" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
                {locale === 'tr' ? 'Ad' : 'First Name'} *
              </label>
              <input 
                type="text" 
                id="participant-first-name" 
                name="firstName" 
                required 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all"
                style="font-family: 'Radio Canada Big', sans-serif;"
              />
            </div>

            <!-- Last Name -->
            <div>
              <label for="participant-last-name" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
                {locale === 'tr' ? 'Soyad' : 'Last Name'} *
              </label>
              <input 
                type="text" 
                id="participant-last-name" 
                name="lastName" 
                required 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all"
                style="font-family: 'Radio Canada Big', sans-serif;"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Title -->
            <div>
              <label for="participant-title" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
                {locale === 'tr' ? 'Ünvan' : 'Title'}
              </label>
              <input 
                type="text" 
                id="participant-title" 
                name="title" 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all"
                style="font-family: 'Radio Canada Big', sans-serif;"
              />
            </div>

            <!-- Phone -->
            <div>
              <label for="participant-phone" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
                {locale === 'tr' ? 'Telefon' : 'Phone'} *
              </label>
              <input 
                type="tel" 
                id="participant-phone" 
                name="phone" 
                required 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all"
                style="font-family: 'Radio Canada Big', sans-serif;"
              />
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- City -->
            <div>
              <label for="participant-city" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
                {locale === 'tr' ? 'Şehir' : 'City'} *
              </label>
              <input 
                type="text" 
                id="participant-city" 
                name="city" 
                required 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all"
                style="font-family: 'Radio Canada Big', sans-serif;"
              />
            </div>

            <!-- Email -->
            <div>
              <label for="participant-email" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
                {locale === 'tr' ? 'E-posta' : 'Email'} *
              </label>
              <input 
                type="email" 
                id="participant-email" 
                name="email" 
                required 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all"
                style="font-family: 'Radio Canada Big', sans-serif;"
              />
            </div>
          </div>
        </div>

        <!-- Company Information Section -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-[#16243D] border-b border-gray-200 pb-2" style="font-family: 'Radio Canada Big', sans-serif;">
            {locale === 'tr' ? 'Kurumsal Bilgiler' : 'Company Information'}
          </h3>
          
          <!-- Company Name -->
          <div>
            <label for="participant-company-name" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
              {locale === 'tr' ? 'Firma Adı' : 'Company Name'} *
            </label>
            <input 
              type="text" 
              id="participant-company-name" 
              name="companyName" 
              required 
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all"
              style="font-family: 'Radio Canada Big', sans-serif;"
            />
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Business Area -->
            <div>
              <label for="participant-business-area" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
                {locale === 'tr' ? 'Faaliyet Alanı' : 'Business Area'} *
              </label>
              <input 
                type="text" 
                id="participant-business-area" 
                name="businessArea" 
                required 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all"
                style="font-family: 'Radio Canada Big', sans-serif;"
              />
            </div>

            <!-- Website -->
            <div>
              <label for="participant-website" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
                {locale === 'tr' ? 'Website' : 'Website'}
              </label>
              <input 
                type="url" 
                id="participant-website" 
                name="website" 
                placeholder="https://"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all"
                style="font-family: 'Radio Canada Big', sans-serif;"
              />
            </div>
          </div>
        </div>

        <!-- Additional Information -->
        <div class="space-y-4">
          <h3 class="text-lg font-semibold text-[#16243D] border-b border-gray-200 pb-2" style="font-family: 'Radio Canada Big', sans-serif;">
            {locale === 'tr' ? 'Ek Bilgiler' : 'Additional Information'}
          </h3>
          
          <!-- Additional Notes -->
          <div>
            <label for="additional-notes" class="block text-sm font-medium text-gray-700 mb-2" style="font-family: 'Radio Canada Big', sans-serif;">
              {locale === 'tr' ? 'Ek Notlar / Özel İstekler' : 'Additional Notes / Special Requests'}
            </label>
            <textarea 
              id="additional-notes" 
              name="additionalNotes" 
              rows="3"
              placeholder={locale === 'tr' ? 'Özel isteklerinizi veya ek bilgileri buraya yazabilirsiniz...' : 'You can write your special requests or additional information here...'}
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#CE1A28] focus:border-transparent transition-all resize-none"
              style="font-family: 'Radio Canada Big', sans-serif;"
            ></textarea>
          </div>
        </div>



        <!-- Form Actions -->
        <div class="flex flex-col sm:flex-row gap-3 pt-6 border-t border-gray-200">
          <button 
            type="button" 
            id="cancel-participant-form"
            class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium"
            style="font-family: 'Radio Canada Big', sans-serif;"
          >
            {locale === 'tr' ? 'İptal' : 'Cancel'}
          </button>
          <button 
            type="submit" 
            class="flex-1 px-6 py-3 bg-[#CE1A28] text-white rounded-lg hover:bg-[#b91c1c] transition-colors font-medium"
            style="font-family: 'Radio Canada Big', sans-serif;"
          >
            {locale === 'tr' ? 'Gönder' : 'Submit'}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('participant-modal');
    const closeBtn = document.getElementById('close-participant-modal');
    const cancelBtn = document.getElementById('cancel-participant-form');
    const form = document.getElementById('participant-form');
    const fairSearch = document.getElementById('participant-fair-search');
    const fairSelect = document.getElementById('participant-fair-select');
    const fairDropdown = document.getElementById('participant-fair-dropdown');
    const fairOptions = document.querySelectorAll('.participant-fair-option');

    // Open modal function
    (window as any).openParticipantModal = () => {
      if (modal) {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
      }
    };

    // Close modal function
    const closeModal = () => {
      if (modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = '';
        if (form) (form as HTMLFormElement).reset();
        if (fairSearch) (fairSearch as HTMLInputElement).value = '';
        if (fairSelect) (fairSelect as HTMLInputElement).value = '';
        if (fairDropdown) fairDropdown.classList.add('hidden');
      }
    };

    // Fair search functionality
    if (fairSearch && fairDropdown && fairOptions.length > 0) {
      // Show dropdown on focus
      fairSearch.addEventListener('focus', () => {
        fairDropdown.classList.remove('hidden');
      });

      // Filter options on input
      fairSearch.addEventListener('input', (e) => {
        const searchTerm = (e.target as HTMLInputElement)?.value?.toLowerCase() || '';
        fairOptions.forEach(option => {
          const text = option.textContent?.toLowerCase() || '';
          if (text.includes(searchTerm)) {
            (option as HTMLElement).style.display = 'block';
          } else {
            (option as HTMLElement).style.display = 'none';
          }
        });
        fairDropdown.classList.remove('hidden');
      });

      // Handle option selection
      fairOptions.forEach(option => {
        option.addEventListener('click', () => {
          const value = option.getAttribute('data-value');
          const text = option.textContent;
          (fairSearch as HTMLInputElement).value = text || '';
          if (fairSelect) (fairSelect as HTMLInputElement).value = value || '';
          fairDropdown.classList.add('hidden');
        });
      });

      // Hide dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!fairSearch.contains(e.target as Node) && !fairDropdown.contains(e.target as Node)) {
          fairDropdown.classList.add('hidden');
        }
      });
    }

    // Event listeners
    if (closeBtn) closeBtn.addEventListener('click', closeModal);
    if (cancelBtn) cancelBtn.addEventListener('click', closeModal);
    
    // Close on backdrop click
    if (modal) {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
    }

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
        closeModal();
      }
    });

    // Form submission with AJAX
    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = new FormData(form as HTMLFormElement);
        
        try {
          const response = await fetch("/", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams(formData as any).toString()
          });
          
          if (response.ok) {
            closeModal();
            // Redirect with success parameter
            window.location.href = `/?success=participant`;
          } else {
            throw new Error('Form submission failed');
          }
        } catch (error) {
          console.error('Form submission error:', error);
          alert(document.documentElement.lang === 'tr' 
            ? 'Form gönderilirken bir hata oluştu. Lütfen tekrar deneyin.' 
            : 'An error occurred while submitting the form. Please try again.'
          );
        }
      });
    }
  });
  
  // Form submission
  const participantForm = document.getElementById('participant-form');
  if (participantForm) {
    participantForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      console.log('🚀 Gmail SMTP: Participant form gönderiliyor...');
      const formData = new FormData(participantForm);
      
      try {
        console.log('🔧 PARTICIPANT: Creating form data...');
        
        // Web3Forms için ekstra fields
        formData.append('access_key', '26c4e2e8-c895-4821-a0fd-450c838a96ec');
        formData.append('subject', `🎪 Yeni Katılımcı Formu - ${formData.get('firstName')} ${formData.get('lastName')}`);
        formData.append('from_name', 'Turkel Fuarcılık');
        formData.append('to_email', 'info@turkel.com.tr');
        
        // Profesyonel HTML Email Template
        const htmlTemplate = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yeni Katılımcı Formu</title>
</head>
<body style="margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa;">
  
  <!-- Email Container -->
  <table width="100%" cellpadding="0" cellspacing="0" style="background-color: #f8f9fa; padding: 20px;">
    <tr>
      <td align="center">
        <table width="600" cellpadding="0" cellspacing="0" style="background-color: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
          
          <!-- Header -->
          <tr>
            <td style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); padding: 30px 20px; text-align: center;">
              <h1 style="color: white; margin: 0; font-size: 28px; font-weight: 600;">🎪 Yeni Katılımcı Formu</h1>
              <p style="color: rgba(255,255,255,0.9); margin: 10px 0 0 0; font-size: 16px;">Turkel Fuarcılık - Website Form Bildirimi</p>
            </td>
          </tr>
          
          <!-- Content -->
          <tr>
            <td style="padding: 30px;">
              
              <!-- Personal Info -->
              <table width="100%" cellpadding="0" cellspacing="0" style="background: #f8f9fa; border-left: 4px solid #17a2b8; border-radius: 8px; margin-bottom: 20px;">
                <tr>
                  <td style="padding: 20px;">
                    <h3 style="color: #333; margin: 0 0 15px 0; font-size: 18px;">👤 Kişisel Bilgiler</h3>
                    <table width="100%" cellpadding="8" cellspacing="0">
                      <tr>
                        <td style="font-weight: 600; color: #555; width: 120px;">Ad Soyad:</td>
                        <td style="color: #333;">${formData.get('firstName')} ${formData.get('lastName')}</td>
                      </tr>
                      <tr>
                        <td style="font-weight: 600; color: #555;">Email:</td>
                        <td style="color: #333;"><a href="mailto:${formData.get('email')}" style="color: #17a2b8; text-decoration: none;">${formData.get('email')}</a></td>
                      </tr>
                      <tr>
                        <td style="font-weight: 600; color: #555;">Telefon:</td>
                        <td style="color: #333;"><a href="tel:${formData.get('phone')}" style="color: #17a2b8; text-decoration: none;">${formData.get('phone')}</a></td>
                      </tr>
                      <tr>
                        <td style="font-weight: 600; color: #555;">Şirket:</td>
                        <td style="color: #333;">${formData.get('companyName')}</td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
              
              <!-- Fair Info -->
              <table width="100%" cellpadding="0" cellspacing="0" style="background: #e1f5fe; border-left: 4px solid #007bff; border-radius: 8px; margin-bottom: 20px;">
                <tr>
                  <td style="padding: 20px;">
                    <h3 style="color: #333; margin: 0 0 15px 0; font-size: 18px;">🎪 Fuar Bilgileri</h3>
                    <table width="100%" cellpadding="8" cellspacing="0">
                      <tr>
                        <td style="font-weight: 600; color: #555; width: 120px;">Katılmak İstenilen Fuar:</td>
                        <td style="color: #333; font-weight: 600;">${formData.get('fair')}</td>
                      </tr>
                      <tr>
                        <td style="font-weight: 600; color: #555;">Form Tipi:</td>
                        <td>
                          <span style="background: #17a2b8; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                            🎪 KATILIMCI
                          </span>
                        </td>
                      </tr>
                      <tr>
                        <td style="font-weight: 600; color: #555;">Dil:</td>
                        <td style="color: #333;">${formData.get('language') === 'tr' ? '🇹🇷 Türkçe' : '🇬🇧 English'}</td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
              
            </td>
          </tr>
          
          <!-- Footer -->
          <tr>
            <td style="background: #f8f9fa; padding: 20px; text-align: center; border-top: 1px solid #eee;">
              <p style="margin: 0; color: #666; font-size: 14px;">
                📅 <strong>Gönderim Zamanı:</strong> ${new Date().toLocaleString('tr-TR', { 
                  weekday: 'long', 
                  year: 'numeric', 
                  month: 'long', 
                  day: 'numeric',
                  hour: '2-digit',
                  minute: '2-digit'
                })}
              </p>
              <p style="margin: 10px 0 0 0; color: #999; font-size: 12px;">
                Bu email <strong>Turkel Fuarcılık</strong> website'inden otomatik olarak gönderilmiştir.
              </p>
            </td>
          </tr>
          
        </table>
      </td>
    </tr>
  </table>
  
</body>
</html>`;
        
        formData.append('message', htmlTemplate);
        
        console.log('🔧 PARTICIPANT: Web3Forms data prepared, sending...');
        
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          body: formData
        });
        
        console.log('📥 Response:', response.status, response.ok);
        
        if (response.ok) {
          closeParticipantModal();
          showParticipantSuccessNotification();
        } else {
          alert(locale === 'tr' ? 'Form gönderilemedi!' : 'Form could not be sent!');
        }
      } catch (error) {
        console.error('Form error:', error);
        alert(locale === 'tr' ? 'Bir hata oluştu!' : 'An error occurred!');
      }
    });
  }
  
  // Success notification
  function showParticipantSuccessNotification() {
    const notification = document.createElement('div');
    notification.innerHTML = `
      <div style="position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 9999; font-family: Arial, sans-serif;">
        <div style="display: flex; align-items: center; gap: 10px;">
          <span>✅</span>
          <div>
            <div style="font-weight: 600;">${locale === 'tr' ? 'Katılımcı formu gönderildi!' : 'Participant form sent!'}</div>
            <div style="font-size: 12px; opacity: 0.9;">${locale === 'tr' ? 'En kısa sürede sizinle iletişime geçeceğiz.' : 'We will contact you soon.'}</div>
          </div>
          <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer; margin-left: 10px;">✕</button>
        </div>
      </div>
    `;
    document.body.appendChild(notification);
    
    // Auto hide after 5 seconds
    setTimeout(() => {
      notification.style.opacity = '0';
      notification.style.transform = 'translateX(100%)';
      setTimeout(() => notification.remove(), 300);
    }, 5000);
  }
  
</script>

<style>
  /* Custom Scrollbar for Fair Dropdown */
  .custom-scrollbar {
    overflow: hidden;
    border-radius: 8px;
  }
  
  .custom-scrollbar > div {
    padding-right: 8px;
    margin-right: -8px;
  }
  
  .custom-scrollbar > div::-webkit-scrollbar {
    width: 8px;
  }
  
  .custom-scrollbar > div::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 10px;
  }
  
  .custom-scrollbar > div::-webkit-scrollbar-thumb {
    background: #CE1A28;
    border-radius: 10px;
    border: 1px solid transparent;
  }
  
  .custom-scrollbar > div::-webkit-scrollbar-thumb:hover {
    background: #B01620;
  }
  
  /* Firefox scrollbar */
  .custom-scrollbar > div {
    scrollbar-width: thin;
    scrollbar-color: #CE1A28 transparent;
  }
  
  /* Smooth dropdown animation */
  #participant-fair-dropdown {
    transition: all 0.3s ease;
    transform-origin: top;
  }
  
  #participant-fair-dropdown.hidden {
    transform: scaleY(0);
    opacity: 0;
  }
  
  #participant-fair-dropdown:not(.hidden) {
    transform: scaleY(1);
    opacity: 1;
  }
  
  /* Dropdown item hover effects */
  .participant-fair-option {
    margin: 0 !important;
    width: 100% !important;
    box-sizing: border-box !important;
    position: relative;
    z-index: 1;
  }
  
  .participant-fair-option:first-child {
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
    overflow: hidden;
  }
  
  .participant-fair-option:last-child {
    border-bottom-left-radius: 8px;
    border-bottom-right-radius: 8px;
    overflow: hidden;
  }
  
  .participant-fair-option:hover {
    background-color: #fef2f2 !important;
    color: #CE1A28 !important;
    transition: all 0.2s ease;
    margin-right: 0 !important;
    padding-right: 16px !important;
    z-index: 2;
  }
  
  .participant-fair-option:first-child:hover {
    border-top-left-radius: 8px !important;
    border-top-right-radius: 8px !important;
    background-color: #fef2f2 !important;
  }
</style>
